$.fn.simpleAudioPlayer=function(a){var b=this,y=$.extend({chapters:[],fadeOutSpeed:3},a),k=[],T=0,x=0,L=0,B=!1,A={player:".simpleAudioPlayer",progressBar:".progressBar",progressBarInner:".progressBarInner",progressBarLoader:".progressBarLoader",progressIndicator:".progressIndicator",progressTime:".progressTime",durationTime:".durationTime",waves:".waves",play:".play",pause:".pause",stop:".stop",forward:".forward",backward:".backward",prev:".prev",next:".next",menuToggle:".menuToggle",chapterList:".chapterList",chapterLink:".chapterLink"};return-1!=navigator.userAgent.indexOf("Firefox")&&(B=!0),this.each(function(a,e){var s=$(this);if("audio"!=s.prop("tagName").toLowerCase())return!1;if(createjs.Sound.initializeDefaultPlugins()){for(var n=0;n<y.chapters.length;n++){if(B&&!y.chapters[n].ogg)return console.log("No audio files."),!0;if(!y.chapters[n].mp3)return console.log("No audio files."),!0}var i=new createjs.LoadQueue;createjs.Sound.alternateExtensions=["mp3","ogg"],i.installPlugin(createjs.Sound),i.addEventListener("fileload",function(a){console.log("loading..."),console.log(a);var e=createjs.Sound.createInstance(a.item.id);k.push({id:""+a.item.id,duration:e.duration/1e3,instance:e}),T+=e.duration/1e3}),i.addEventListener("complete",function(a){console.log("complete"),console.log(a),k.length===y.chapters.length&&(k.sort(function(a,e){return parseInt(a.id)-parseInt(e.id)}),d("next").hasClass("inactive")&&d("next").removeClass("inactive"),d("forward").hasClass("inactive")&&d("forward").removeClass("inactive"),d("backward").hasClass("inactive")&&d("backward").removeClass("inactive"),d("prev").hasClass("inactive")&&d("prev").removeClass("inactive"),d("play").hasClass("inactive")&&d("play").removeClass("inactive"),d("pause").hasClass("inactive")&&d("pause").removeClass("inactive"),f())}),i.addEventListener("progress",function(a){console.log(a.loaded),$(d("progressBarLoader")).css("width",100*(a.loaded-.25)/.75+"%")});var t=Array();for(n=0;n<y.chapters.length;n++){var r=B?y.chapters[n].ogg:y.chapters[n].mp3;t.push({id:""+n,src:r})}i.loadManifest(t);var c='<div class="'+A.player.substr(1)+'"><div class="containerTop cf"><div class="controls row"><div class="col c2 inactive '+A.prev.substr(1)+'"><span class="icon icon-prev"></span></div><div class="col c2 inactive '+A.backward.substr(1)+'"><span class="icon icon-backward"></span></div><div class="col c2 inactive '+A.play.substr(1)+'"><span class="icon icon-play"></span></div><div class="col c2 inactive hide '+A.pause.substr(1)+'"><span class="icon icon-pause"></span></div><div class="col c2 inactive '+A.forward.substr(1)+'"><span class="icon icon-forward"></span></div><div class="col c2 inactive '+A.next.substr(1)+'"><span class="icon icon-next"></span></div></div></div><div class="containerBottom cf"><div class="'+A.progressBar.substr(1)+'"><div class="'+A.progressTime.substr(1)+'">&nbsp;</div><div class="'+A.progressBarLoader.substr(1)+'"></div><div class="'+A.progressBarInner.substr(1)+'"></div><div class="'+A.progressIndicator.substr(1)+'"></div><div class="'+A.durationTime.substr(1)+'">&nbsp;</div></div></div>',o=$(c).insertAfter(s);if(s.css({width:0,height:0,visibility:"hidden"}),0<y.chapters.length){$(A.player).addClass("hasChapters"),d("menuToggle").append('<span class="icon icon-menu"></span>');var l="<ul>";for(n=0;n<y.chapters.length;n++)l+='<li><a class="'+A.chapterLink.substr(1)+'" data-chapter="'+y.chapters[n].seconds+'">'+y.chapters[n].title+"</a></li>";l+="</ul>",d("chapterList").append(l)}b.jumpBy=function(a){C(a)},b.jumpTo=function(a){var e;e=a,s[0].currentTime=e,f()},b.fadeOut=function(a){m(a)},b.fadeOutAfterSeconds=function(a,e){fadeOutAfterSeconds(a,e)},b.fadeOutAfterChapter=function(a,e){fadeOutAfterChapter(a,e)},b.fadeOutAfterPercent=function(a,e){fadeOutAfterPercent(a,e)},d("play").on("click",p),d("pause").on("click",u),d("forward").on("click",v),d("backward").on("click",h),d("prev").on("click",function(){0<L&&(k[L].instance.paused=!0,k[L-=1].instance.position=0,k[L].instance.play())}),d("next").on("click",function(){g()}),$(window).keydown(function(a){switch(a.keyCode){case 32:s[0].paused?p():u();break;case 37:h();break;case 39:v()}}),setInterval(function(){if(k.length!=y.chapters.length||k[L].instance.pause)k.length==y.chapters.length&&k[L].instance.position>=k[L].instance.duration&&g();else{for(var a=x=0;a<L;a++)x+=k[a].duration;x+=k[L].instance.position/1e3,f()}},100),setTimeout(f,200)}function d(a){if(o)return o.find(A[a])}function p(){k[L].instance.play()}function u(){k[L].instance.paused=!0,d("play").toggleClass("hide"),d("pause").toggleClass("hide")}function v(){C(30)}function h(){C(-30)}function f(){var a,e,s,n,i,t,r,c,o;!function(){if(k.length!=y.chapters.length)return;w(-30)?d("backward").hasClass("inactive")&&d("backward").removeClass("inactive"):!d("backward").hasClass("inactive")&&d("backward").addClass("inactive");w(30)?d("forward").hasClass("inactive")&&d("forward").removeClass("inactive"):!d("forward").hasClass("inactive")&&d("forward").addClass("inactive");0==L?!d("prev").hasClass("inactive")&&d("prev").addClass("inactive"):d("prev").hasClass("inactive")&&d("prev").removeClass("inactive");L==y.chapters.length-1?!d("next").hasClass("inactive")&&d("next").addClass("inactive"):d("next").hasClass("inactive")&&d("next").removeClass("inactive");null==k[L].instance.playState||1==k[L].instance.paused?(!d("pause").hasClass("hide")&&d("pause").addClass("hide"),d("play").hasClass("hide")&&d("play").removeClass("hide")):(!d("play").hasClass("hide")&&d("play").addClass("hide"),d("pause").hasClass("hide")&&d("pause").removeClass("hide"))}(),a=T-x,e=Math.round(Math.floor(a/60)),s=Math.round(a-60*e),n=("0"+e).slice(-2)+":"+("0"+s).slice(-2),i=x,t=Math.round(Math.floor(i/60)),r=Math.round(i-60*t),c=("0"+t).slice(-2)+":"+("0"+r).slice(-2),d("progressTime").html(c),d("durationTime").html("- "+n),o=x/T*100,$(d("progressBarInner")).css("width",o+"%")}function g(){L==k.length-1?(k[L].instance.paused=!0,x=L=0,k[L].instance.position=0,f()):(k[L].instance.paused=!0,k[L+=1].instance.position=0,k[L].instance.play())}function m(a){var e=(a=void 0!==a?a:y.fadeOutSpeed)/1e3;.001<s[0].volume?(s[0].volume-=.001,setTimeout(m,e)):resetPlaybackTime()}function C(a){w(a)&&(k[L].instance.position+=1e3*a,x+=a,f())}function w(a){if(k.length!=y.chapters.length)return!1;var e=0<a&&k[L].instance.position/1e3<k[L].duration-a,s=a<0&&0<k[L].instance.position/1e3+a;return!(!e&&!s)}})};